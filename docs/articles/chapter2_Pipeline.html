<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2. The GGIR pipeline • GGIR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. The GGIR pipeline">
<script defer data-domain="pkgdown.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">GGIR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1-7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-the-book" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">The book</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-the-book">
<li><a class="dropdown-item" href="../articles/chapter1_WhatIsGGIR.html">1. What is GGIR</a></li>
    <li><a class="dropdown-item" href="../articles/chapter2_Pipeline.html">2. The GGIR Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/chapter3_QualityAssessment.html">3. Data Quality Assurance</a></li>
    <li><a class="dropdown-item" href="../articles/chapter4_AccMetrics.html">4. From Raw Data to Acceleration Metrics</a></li>
    <li><a class="dropdown-item" href="../articles/chapter5_StudyProtocol.html">5. Accounting for Study Protocol</a></li>
    <li><a class="dropdown-item" href="../articles/chapter6_DataImputation.html">6. How GGIR Deals with Invalid Data</a></li>
    <li><a class="dropdown-item" href="../articles/chapter7_DescribingDataWithoutKnowingSleep.html">7. Describing the Data Without Knowing Sleep</a></li>
    <li><a class="dropdown-item" href="../articles/chapter8_SleepFundamentalsSibs.html">8. Sleep Fundamentals - Sustained Inactivity Bout Detection (SIB)</a></li>
    <li><a class="dropdown-item" href="../articles/chapter9_SleepFundamentalsGuiders.html">9. Sleep Fundamentals - Guiding Sleep Detection</a></li>
    <li><a class="dropdown-item" href="../articles/chapter10_SleepAnalysis.html">10. Sleep Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/chapter11_DescribingDataCutPoints.html">11. Physical Activity Fundamentals - Describing the data with cut-points</a></li>
    <li><a class="dropdown-item" href="../articles/chapter12_TimeUseAnalysis.html">12. Time-Use Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/chapter13_CircadianRhythm.html">13. Circadian Rhythm Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/chapter14_BehaviouralFragmentation.html">14. Behavioural Fragmentation</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-annexes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Annexes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-annexes">
<li><a class="dropdown-item" href="../articles/GGIRParameters.html">GGIR Parameters</a></li>
    <li><a class="dropdown-item" href="../articles/GGIRoutput.html">GGIR Output</a></li>
    <li><a class="dropdown-item" href="../articles/readmyacccsv.html">Reading csv files with raw data</a></li>
    <li><a class="dropdown-item" href="../articles/ExternalFunction.html">Embedding external functions in GGIR</a></li>
    <li><a class="dropdown-item" href="../articles/CutPoints.html">Published cut-points and how to use them</a></li>
    <li><a class="dropdown-item" href="../articles/TutorialDaySegmentAnalyses.html">Day-segment analyses</a></li>
    <li><a class="dropdown-item" href="../articles/HouseHoldCoanalysis.html">Household co-analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Cookbook.html">Cookbook</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/chapter0_Installation.html">Installation</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/chapter0_GetStarted.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-3-1-5/">Version 3.1-5</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-3-1-0/">Version 3.1-0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-3-0-0/">Version 3.0-0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-2-9-0/">Version 2.9-0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-2-8-0/">Version 2.8-0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-2-7-1/">Version 2.7-1</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-2-6-0/">Version 2.6-0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-2-5-0/">Version 2.5-0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/chapter0_Contributing.html">Contributing</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/chapter0_Support.html">Need help?</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/wadpac/GGIR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>2. The GGIR pipeline</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/wadpac/GGIR/blob/HEAD/vignettes/chapter2_Pipeline.Rmd" class="external-link"><code>vignettes/chapter2_Pipeline.Rmd</code></a></small>
      <div class="d-none name"><code>chapter2_Pipeline.Rmd</code></div>
    </div>

    
    
<p>As explained in chapter 1, GGIR offers a vast amount of
functionality. If you arrive here with the expectation to find a quick
instruction to run and use GGIR then we have to disappoint you. Learning
to use GGIR requires some time investment. In this chapter we start with
explaining the GGIR pipeline, which you could see as the high level
structure of GGIR. Understanding this structure will help you navigate
the following chapters.</p>
<div class="section level2">
<h2 id="the-ggir-function">The GGIR function<a class="anchor" aria-label="anchor" href="#the-ggir-function"></a>
</h2>
<p>As brief introduction for those unfamiliar with R or software, R
packages are constructed of sub-components, named functions. A single
function typically allows for doing a specific task. For example, we may
have the <code>sum</code> function that sums the numbers we provide to
it. A function can have one or multiple parameters to control the
functions behaviour. In R these parameters are call function arguments.
For example, <code>sum</code> has the argument <code>na.rm</code> to
control what needs to be done with missing values. In GGIR we refer to
these arguments as parameters.</p>
<p>GGIR comes with a large number of functions and parameters that
together form a processing pipeline. To ease interacting with GGIR, it
has one central function to act as interface to all functionality. This
function is also named <code>GGIR</code>. You only need to learn how to
work with the function <code>GGIR</code>, but it is important to
understand that in the background this function interacts with all other
functions in GGIR.</p>
<p>Further, it is important to understand that the
<code>GGIR package</code> is structured in two complementary ways:</p>
<ul>
<li>
<strong>Parts:</strong> Reflecting the computational components when
running GGIR. GGIR has 6 parts numbered from 1 to 6 to reflect the order
in which they are executed. The reason why GGIR is split up in parts is
that it avoids having to re-run all preceding parts if you only want to
make a small change in the more downstream parts. The parts together
form the pipeline.</li>
<li>
<strong>Parameter themes:</strong> Reflecting the themes around
which the user can control GGIR, e.g. controlling how sleep is detected
or controlling what output is stored and how it is stored.</li>
</ul>
<div class="section level3">
<h3 id="parts-of-the-pipeline">Parts of the pipeline<a class="anchor" aria-label="anchor" href="#parts-of-the-pipeline"></a>
</h3>
<p>GGIR, has a computational structure of six parts which are applied
sequentially to the data:</p>
<ul>
<li>
<strong>Part 1:</strong> Loads the data, works on data quality, and
stores derived summary measures per time interval, also known as signal
features or metrics, as needed for the following parts.</li>
<li>
<strong>Part 2:</strong> Basic data quality assessment based on the
extract metrics and description of the data per day, per file, and
optionally per day segment.</li>
<li>
<strong>Part 3:</strong> Estimation rest periods, needed for input
to Part 4.</li>
<li>
<strong>Part 4:</strong> Labels the rest periods derived in Part 3
as sleep per night and per file.</li>
<li>
<strong>Part 5:</strong> Compiles time series with classification of
sleep and physical behaviour categories by re-using information derived
in part 2, 3, and 4. This includes the detection of behavioural bouts,
which are time segments where the same behaviour is sustained for
duration as specified by the user. Next, Part 5 generates a descriptive
summary such as time spent in and average acceleration per behavioural
category, but also behavioural fragmentation.</li>
<li>
<strong>Part 6:</strong> Facilitates analyses that span the full
recording such as household co-analysis and circadian rhythm
analysis.</li>
</ul>
<p>The specific order and content of the parts have evolved over time,
with Part 1 and 2 created in 2011-2013, Part 3 and 4 created in
2013-2015, Part 5 created in 2017-2020, and Part 6 created in 2023-2024.
So, the parts also reflect the historical expansion of GGIR.</p>
<div class="section level4">
<h4 id="milestone-data">Milestone data<a class="anchor" aria-label="anchor" href="#milestone-data"></a>
</h4>
<p>Each part, when run, stores its output in an R-data file that has
<code>.RData</code> as its extension, which we refer to as the milestone
data. As user, you are unlikely to ever need to interact directly with
the milestone data files because all relevant output for you is stored
in csv and pdf files in the output folder <code>results</code>.</p>
<p>The milestone files are read by the next GGIR part. The advantage of
this design is that it offers internal modularity. For example, we can
run part 1 now and continue with part 2 another time without having to
repeat part 1 again. So, this design eases re-processing and is also
helpful for us when developing and testing the GGIR code.</p>
<p>The milestone data files are stored in sub-folders of the output
folder as show below. Note that the output folder is named
<code>output_mystudy</code> as example but exact name may differ for
you.</p>
<ul>
<li>For part 1: <code>output_mystudy/meta/basic</code>.</li>
<li>For part 2: <code>output_mystudy/meta/ms2.out</code>.</li>
<li>For part 3: <code>output_mystudy/meta/ms3.out</code>.</li>
<li>For part 4: <code>output_mystudy/meta/ms4.out</code>.</li>
<li>For part 5: <code>output_mystudy/meta/ms5.out</code>.</li>
<li>For part 6: <code>output_mystudy/meta/ms6.out</code>.</li>
</ul>
<p>The milestone files are potentially useful for you for the following
reasons:</p>
<ul>
<li>By copying the milestone files to a new computer, you may continue
your analyses without access to the original data files. This can for
example be helpful if you process subsets of the same study on different
computers, pooling the resulting milestone data allows you to finalise
your analysis on a single computer. Remember to preserve the same folder
structure.</li>
<li>When you run into a problem, the milestone files may allow you to
share the problem as a reproducible example of the problem without
having to share the original large data file.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="parameter-themes">Parameter themes<a class="anchor" aria-label="anchor" href="#parameter-themes"></a>
</h3>
<p>The parameters of all GGIR package functions can be used as parameter
to the GGIR function. The parameters are internally grouped
thematically, independently of the six parts they are used in:</p>
<ul>
<li>
<strong>params_rawdata:</strong> parameters related to handling the
raw data such as resampling or calibrating.</li>
<li>
<strong>params_metrics:</strong> parameters related to aggregating
the raw data to epoch level summary measures (metrics).</li>
<li>
<strong>params_sleep:</strong> parameters related to sleep
detection.</li>
<li>
<strong>params_phyact:</strong> parameters related to physical
(in)activity.</li>
<li>
<strong>params_247:</strong> parameters related to 24/7 behaviours
that do not fall into the typical sleep or physical (in)activity
research category such as measures of circadian rhythm or more 24 hour
data description techniques.</li>
<li>
<strong>params_output:</strong> parameters relating to how and
whether output is stored.</li>
<li>
<strong>params_general:</strong> general parameters not covered by
any of the above categories</li>
</ul>
<p>As GGIR user you do not need to remember which theme a parameter
belongs to. However, you may notice that the documentation is structure
by parameter theme to ease navigating the parameters.</p>
<p>There are a couple of ways to inspect the parameters in each
parameter category and their default values:</p>
<div class="section level4">
<h4 id="ggir-function-documentation">GGIR function documentation:<a class="anchor" aria-label="anchor" href="#ggir-function-documentation"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">GGIR</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="parameters-vignette">Parameters vignette:<a class="anchor" aria-label="anchor" href="#parameters-vignette"></a>
</h4>
<p>Documentation on the meaning of each parameter, its default value,
and expected value(s) can be found in the vignette: <a href="https://wadpac.github.io/GGIR/articles/GGIRParameters.html">GGIR
configuration parameters</a>.</p>
</div>
<div class="section level4">
<h4 id="from-r-command-line">From R command line:<a class="anchor" aria-label="anchor" href="#from-r-command-line"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wadpac/GGIR/" class="external-link">GGIR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/load_params.html">load_params</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If you are only interested in one specific category like sleep:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wadpac/GGIR/" class="external-link">GGIR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/load_params.html">load_params</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">params_sleep</span><span class="op">)</span></span></code></pre></div>
<p>If you are only interested in e.g. parameter <code>HASIB.algo</code>
from the</p>
<p><code>sleep_params</code> object:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wadpac/GGIR/" class="external-link">GGIR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/load_params.html">load_params</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">params_sleep</span><span class="op">[[</span><span class="st">"HASIB.algo"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>All of these parameters are accepted as parameter to function
<code>GGIR</code>, because <code>GGIR</code> is like a shell around all
GGIR functionality. However, the <code>params_</code> objects themselves
cannot be provided as input to <code>GGIR</code>.</p>
</div>
<div class="section level4">
<h4 id="configuration-file-">Configuration file.<a class="anchor" aria-label="anchor" href="#configuration-file-"></a>
</h4>
<p>GGIR stores all the parameter values in a csv-file named config.csv.
The file is stored after each run of GGIR in the root of the output
folder, overwriting any existing config.csv file. So, if you would like
to add annotations in the file, e.g. in the fourth column, then you will
need to store it somewhere outside the output folder and specify the
path to that file with parameter <code>configfile</code>. Note that
parameters <code>datadir</code> and <code>outputdir</code>discussed
below always need to be specified directly and are not part of the
configfile.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wadpac/GGIR/" class="external-link">GGIR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/GGIR.html">GGIR</a></span><span class="op">(</span>datadir <span class="op">=</span> <span class="st">"C:/mystudy/mydata"</span>,</span>
<span>     outputdir <span class="op">=</span> <span class="st">"D:/myresults"</span>, </span>
<span>     configfile <span class="op">=</span> <span class="st">"D:/myconfigfiles/config.csv"</span><span class="op">)</span></span></code></pre></div>
<p>The practical value of this is that it eases the replication of the
analysis, because instead of having to share you R script with
colleagues, sharing your config.csv file will be sufficient. Please make
sure you have the same GGIR and R version installed when using this for
reproducibility. See <a href="https://wadpac.github.io/GGIR/articles/chapter0_Installation.html">here</a>
for guidance on how to install older package versions.</p>
</div>
<div class="section level4">
<h4 id="parameter-extraction-order">Parameter extraction order<a class="anchor" aria-label="anchor" href="#parameter-extraction-order"></a>
</h4>
<p>If parameters are provided in the GGIR call, then GGIR always uses
those. If parameters are not provided in GGIR call, GGIR checks whether
there is a config.csv file either in the output folder or specified via
parameter <code>configfile</code> and loads those values. If a parameter
is neither specified in the GGIR function call nor available in the
config.csv file, then GGIR will use its default value’s which can be
inspected as discussed in the section above. Here, it is important to
realise that a consequence of this logic is that GGIR will not revert to
its default parameter values in a repeated run of GGIR unless you remove
the parameter from the function call and delete the config.csv file or
you specify the original (default) value of the parameter explicitly in
you GGIR call.</p>
<p>To ensure this is clear here are some example:</p>
<ul>
<li>If GGIR is used for the first time without specifying parameter
<code>mvpathreshold</code>, then it will use the default value, which is
100.</li>
<li>If you specify <code>mvpathreshold = 120</code>, then GGIR will use
this instead and store it in the config.csv file.</li>
<li>If you run GGIR again but this time delete
<code>mvpathreshold = 120</code> from your GGIR call, then GGIR will
fall back on the value 120 as now stored in the config.csv file.</li>
<li>If you delete the config.csv file and run GGIR again, then the value
100 will be used again.</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="input-files">Input files<a class="anchor" aria-label="anchor" href="#input-files"></a>
</h2>
<div class="section level3">
<h3 id="raw-data">Raw data<a class="anchor" aria-label="anchor" href="#raw-data"></a>
</h3>
<ol style="list-style-type: decimal">
<li>GGIR currently works with the following accelerometer brands and
formats:</li>
</ol>
<ul>
<li>
<a href="https://activinsights.com/" class="external-link">GENEActiv</a> .bin</li>
<li>
<a href="https://axivity.com/" class="external-link">Axivity</a> AX3 and AX6 .cwa</li>
<li>
<a href="https://theactigraph.com" class="external-link">ActiGraph</a> .csv and .gt3x
(.gt3x only the newer format generated with firmware versions above
2.5.0. Serial numbers that start with “NEO” or “MRA” and have firmware
version of 2.5.0 or earlier use an older format of the .gt3x file). If
you want to work with .csv exports via the commercial ActiLife software,
then note that you have the option to export data with timestamps, which
should be turned off. To cope with the absence of timestamps GGIR will
calculate timestamps from the sample frequency, the start time, and
start date as presented in the file header.</li>
<li>
<a href="https://www.movisens.com/en/" class="external-link">Movisens</a> with data stored
in folders.</li>
<li>Any other accelerometer brand that generates csv output, see
documentation for functions <code>read.myacc.csv</code> and parameter
<code>rmc.noise</code> in the vignette <a href="https://cran.r-project.org/package=GGIR/vignettes/readmyacccsv.html" class="external-link">Reading
csv files with raw data in GGIR</a>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="externally-derived-epoch-level-data">Externally derived epoch-level data<a class="anchor" aria-label="anchor" href="#externally-derived-epoch-level-data"></a>
</h3>
<p>By default GGIR assumes that the data is raw as discussed in chapter
1. However, for some studies raw data is not available and all we have
is an epoch level aggregate. For example, done by external software or
done inside the accelerometer device. Although this can introduce some
severe limitations to the transparency and flexibility of our analysis,
GGIR makes an attempt to facilitate the analysis of these externally
performed aggregations of the raw data. Please find below an overview of
the file format currently facilitated:</p>
<table style="width:100%;" class="table">
<caption>Note: For Actiwatch and ActiGraph, physical activity
description and sleep classification needs to be tailored to
count-specific algorithms: <code>do.neishabouricounts = TRUE</code>,
<code>acc.metric = "NeishabouriCount_x"</code>,
<code>HASPT.algo = "NotWorn"</code> <code>HASIB.algo = "NotWorn"</code>;
Note 2: For UK Biobank csv epoch data, GGIR does not facilitate sleep
analysis as arm angle is not exported.</caption>
<colgroup>
<col width="33%">
<col width="31%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th>Sensor brand</th>
<th>Data format</th>
<th>Parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Actiwatch</td>
<td>.csv</td>
<td>
<code>dataFormat = "actiwatch_csv"</code>
<code>extEpochData_timeformat = "%m/%d/%Y %H:%M:%S"</code>
</td>
</tr>
<tr class="even">
<td>Actiwatch</td>
<td>.awd</td>
<td>
<code>dataFormat = "actiwatch_awd"</code>
<code>extEpochData_timeformat = "%m/%d/%Y %H:%M:%S"</code>
</td>
</tr>
<tr class="odd">
<td>ActiGraph</td>
<td>.csv (count files, not be confused with csv raw data files)</td>
<td>
<code>dataFormat = "actigraph_csv"</code>
<code>extEpochData_timeformat = "%m/%d/%Y %H:%M:%S"</code>
</td>
</tr>
<tr class="even">
<td>Axivity</td>
<td>UKBiobank csv export of epoch level data</td>
<td><code>dataFormat = "ukbiobank_csv"</code></td>
</tr>
<tr class="odd">
<td>SenseWear</td>
<td>.xls or .xlsx</td>
<td>
<code>dataFormat = "sensewear_xls"</code>
<code>extEpochData_timeformat = "%d-%m-%Y %H:%M:%S"</code>
</td>
</tr>
</tbody>
</table>
<p>See <a href="https://wadpac.github.io/GGIR/articles/Cookbook.html">GGIR
CookBook</a> for example recipes for working with external data.</p>
<p>To process these files, GGIR loads their content and saves it as GGIR
part 1 milestone data, essentially fooling the rest of GGIR to think
that GGIR part 1 created them based on raw data input. As will be
discussed in chapter 3, GGIR does non-wear detection in two steps: The
first step is done in part 1 and the second step is done in part 2. In
relation to externally derived epoch data non-wear is detected by
looking for consecutive zeros of one hour (Actiwatch, ActiGraph) or
derived from the file (UK Biobank csv).</p>
<ol start="2" style="list-style-type: decimal">
<li>All accelerometer data that need to be analysed should be stored in
one folder or subfolders of that folder. Make sure that the folder does
not contain any files that are not accelerometer data.</li>
<li>Choose an appropriate name for the folder, preferable with a
reference to the study or project it is related to rather than just
‘data’, because the name of this folder will be used as an identifier of
the dataset and integrated in the name of the output folder GGIR
creates.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="how-to-run-your-analysis">How to run your analysis?<a class="anchor" aria-label="anchor" href="#how-to-run-your-analysis"></a>
</h2>
<p>The bare minimum input needed for <code>GGIR</code> is:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wadpac/GGIR/" class="external-link">GGIR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/GGIR.html">GGIR</a></span><span class="op">(</span>datadir <span class="op">=</span> <span class="st">"C:/mystudy/mydata"</span>,</span>
<span>     outputdir <span class="op">=</span> <span class="st">"D:/myresults"</span><span class="op">)</span></span></code></pre></div>
<p>Parameter <code>datadir</code> allows you to specify where you have
stored your accelerometer data and <code>outputdir</code> allows you to
specify where you would like the output of the analyses to be stored.
This cannot be equal to <code>datadir</code>. If you copy and paste the
above code to a new R script (file ending with .R) and Source it in
R(Studio), then the dataset will be processed and the output will be
stored in the specified output directory. GGIR refers to file
directories and not to folders. For those unfamiliar with the term
directory: It is the same as a folder.</p>
<p>Next, we can add parameter <code>mode</code> to tell GGIR which
part(s) to run, e.g. <code>mode = 1:5</code> tells GGIR to run all five
parts and is the default. With parameter <code>overwrite</code>, we can
tell GGIR whether to overwrite previously produced milestone data or
not.</p>
<p>Further, parameter <code>idloc</code> tells GGIR where to find the
participant ID. The default setting most likely does not work for most
data formats, by which it is important that you tailor the value of this
parameter to your study setting. For example, if you files start with a
participant ID followed by an underscore then set <code>idloc=2</code>.
See documentation for parameter <code>idloc</code> for other
examples.</p>
<p>GGIR stores its output csv files with a comma as default column
separator and a dot as default decimal separator as is the standard in
UK/US. However, if your computer is configured for a different region of
the world then these can be modified with parameters
<code>sep_reports</code> and <code>dec_reports</code>, respectively.</p>
<div class="section level3">
<h3 id="from-the-r-console-on-your-own-desktoplaptop">From the R console on your own desktop/laptop<a class="anchor" aria-label="anchor" href="#from-the-r-console-on-your-own-desktoplaptop"></a>
</h3>
<p>Create an R-script and put in it <code><a href="https://github.com/wadpac/GGIR/" class="external-link">library(GGIR)</a></code> and on
the next line the GGIR call as in
<code>GGIR(datadir="yourdatapath", outputdir="yourdatapath")</code>.
Next, you can source the R-script with the <code>source</code> button in
RStudio: <code>source("pathtoscript/myshellscript.R")</code></p>
<p>GGIR by default supports multi-thread processing which is used to
process one input file per process, speeding up the processing of your
data. This can be turned off by setting parameter
<code>do.parallel = FALSE</code>.</p>
</div>
<div class="section level3">
<h3 id="in-a-cluster">In a cluster<a class="anchor" aria-label="anchor" href="#in-a-cluster"></a>
</h3>
<p>If processing data with GGIR on your desktop/laptop is not fast
enough, we advise using GGIR on a computing cluster. The way we did it
on a Sun Grid Engine cluster is shown below. Please note that some of
these commands are specific to the computing cluster you are working on.
Please consult your local cluster specialist to explore how to run GGIR
on your cluster. Here, we only share how we did it. We had three files
for the SGE setting:</p>
<p><strong>submit.sh</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">707</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    <span class="va">n</span><span class="op">=</span>1</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="va">s</span><span class="op">=</span><span class="va">$(($(($n</span> <span class="op">*</span> $<span class="op">[</span><span class="va">$i</span>-1<span class="op">]</span><span class="va">))</span><span class="op">+</span><span class="dv">1</span><span class="va">))</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="va">e</span><span class="op">=</span><span class="va">$(($i</span> <span class="op">*</span> <span class="va">$n))</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="ex">qsub</span> /home/nvhv/WORKING_DATA/bashscripts/run-mainscript.sh <span class="va">$s</span> <span class="va">$e</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p><strong>run-mainscript.sh</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co">#! /bin/bash</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#$ -cwd -V</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#$ -l h_vmem=12G</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="ex">/usr/bin/R</span> <span class="at">--vanilla</span> <span class="at">--args</span> f0=<span class="va">$1</span> f1=<span class="va">$2</span> <span class="op">&lt;</span> /home/nvhv/WORKING_DATA/test/myshellscript.R</span></code></pre></div>
<p><strong>myshellscript.R</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>echo<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">args</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/commandArgs.html" class="external-link">commandArgs</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">args</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/GGIR.html">GGIR</a></span><span class="op">(</span>f0<span class="op">=</span><span class="va">f0</span>,f1<span class="op">=</span><span class="va">f1</span>,<span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>You will need to update the <code>...</code> in the last line with
the parameters you used for <code>GGIR</code>. Note that
<code>f0=f0,f1=f1</code> is essential for this to work. The values of
<code>f0</code> and <code>f1</code> are passed on from the bash script.
Once this is all setup, you will need to call
<code>bash submit.sh</code> from the command line. With the help of
computing clusters, GGIR has successfully been run on some of the
world’s largest accelerometer datasets such as UK Biobank and the German
NAKO study.</p>
</div>
</div>
<div class="section level2">
<h2 id="processing-time">Processing time<a class="anchor" aria-label="anchor" href="#processing-time"></a>
</h2>
<p>The time to process a typical seven-day recording should be anywhere
in between 3 and 10 minutes depending on the sample frequency of the
recording, the sensor brand, data format, the exact configuration of
GGIR, and the specifications of your computer. If you are observing
processing times of 20 minutes or longer for a seven-day recording then
probably you are slowed down by other factors.</p>
<p>Some tips on how you may be able to address this:</p>
<ul>
<li>Make sure the data you process is on the same machine as where GGIR
is run. Processing data located somewhere else on a computer network can
substantially slow down software.</li>
<li>Make sure your machine has 8GB or more RAM memory. Using GGIR on old
machines with only 4GB is known to be slow. However, total memory is not
the only bottle neck. Also consider the number of processes (threads)
your CPU can run relative to the amount of memory. Ending up with 2GB
per process seems a good target. It can be helpful to turn off parallel
processing with <code>do.parallel = FALSE</code>.</li>
<li>Avoid doing other computational activities on your machine while
running GGIR. For example, if you use DropBox or OneDrive make sure they
do not sync while you are running GGIR. It is probably best not to use
the machine when using GGIR to process large datasets. Make sure the
machine is configured not to automatically turn off after X hours as
that would terminate GGIR. Further, you may want to configure the
machine to not fall asleep as this pauses GGIR.</li>
<li>Lower value of parameter <code>maxNcores</code> which by default
uses the number of available cores derived with command
<code><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">parallel::detectCores()</a></code> minus 1. This might in some cases
be too demanding for your operating system.</li>
<li>Reduce the amount of data GGIR loads in memory with parameter
<code>chunksize</code>, which can be useful on machines with limited
memory or when processing many files in parallel. A
<code>chunksize</code> value of 0.2 will make GGIR load the data in
chunks of only 20% of the size relative to the chunks it loads by
default, which is approximately 12 hours of data for the
auto-calibration routine and 24 hours of data for the calculation of
signal metrics.</li>
</ul>
</div>
<div class="section level2">
<h2 id="ggir-output">GGIR output<a class="anchor" aria-label="anchor" href="#ggir-output"></a>
</h2>
<p>GGIR always creates an output folder in the location as specified
with parameter <code>outputdir</code>. The output folder name is
constructed as <code>output_</code> followed by the name of the dataset
which is derived from the most distal folder name of the data directory
as specified with <code>datadir</code>. We recommend this approach
because it ensures that the output folder and data directory have
matching names. In that way there is less likely confusion about what
data folder the output relates to. However, it is possible to use
<code>datadir</code> to specify a vector with paths to individual files,
which may helpful if you want to process a set of files but are not in a
position to move them to a new folder. In that scenario, you will need
to set parameter <code>studyname</code> to tell GGIR what the dataset
name is.</p>
<p>Inside the output folder GGIR will create two subfolders:
<code>meta</code> and <code>results</code> as discussed earlier in this
chapter. Inside <code>results</code> you will find folder named
<code>QC</code> (Quality Checks). The name QC (Quality Checks) is
possibly somewhat confusing. Data quality checks are best started with
the files stored in the results folder, where the files in the QC
subfolder offer complementary information to help with the quality
check.</p>
<p>GGIR generates reports in the parts 2, 4, 5, and 6 of the pipeline.
With parameter <code>do.report</code> you can specify for which of these
parts you want the reports to be generated. For example,
<code>do.report = c(2, 5)</code> will only generate the report for parts
2 and 5. For a full GGIR analysis we expect at least the following
output files:</p>
<p><strong><em>Output files in results subfolder:</em></strong></p>
<table class="table">
<caption>A detailed discussion of each output can be found in the other
chapters.</caption>
<colgroup>
<col width="52%">
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th>File path</th>
<th>Resolution</th>
<th>GGIR part</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>part2_summary.csv</td>
<td>one row per recording</td>
<td>2</td>
</tr>
<tr class="even">
<td>part2_daysummary.csv</td>
<td>one row per day</td>
<td>2</td>
</tr>
<tr class="odd">
<td>part4_summary_sleep_cleaned.csv</td>
<td>one row per recording</td>
<td>4</td>
</tr>
<tr class="even">
<td>part4_nightsummary_sleep_cleaned.csv</td>
<td>one row per night</td>
<td>4</td>
</tr>
<tr class="odd">
<td>visualisation_sleep.pdf</td>
<td>40 recordings per page</td>
<td>4</td>
</tr>
<tr class="even">
<td>part5_daysummary_WW_L40M100V400_T5A5.csv</td>
<td>one row per day</td>
<td>5</td>
</tr>
<tr class="odd">
<td>part5_personsummary_WW_L40M100V400_T5A5.csv</td>
<td>one row per recording</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><strong><em>Output files in results/QC subfolder:</em></strong></p>
<table class="table">
<caption>A detailed discussion of each output can be found in the other
chapters.</caption>
<colgroup>
<col width="52%">
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th>File path</th>
<th>Resolution</th>
<th>GGIR part</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>data_quality_report.csv</td>
<td>one row per recording</td>
<td>5</td>
</tr>
<tr class="even">
<td>part4_summary_sleep_full.csv</td>
<td>one row per recording</td>
<td>4</td>
</tr>
<tr class="odd">
<td>part4_nightsummary_sleep_full.csv</td>
<td>one row per night</td>
<td>4</td>
</tr>
<tr class="even">
<td>part5_daysummary_full_WW_L40M100V400_T5A5.csv</td>
<td>one row per day</td>
<td>5</td>
</tr>
<tr class="odd">
<td>plots_to_check_data_quality_1.pdf</td>
<td>one recording per page</td>
<td>2</td>
</tr>
</tbody>
</table>
<p><strong><em>Output files in meta/ms5.outraw
subfolder:</em></strong></p>
<table class="table">
<caption>A detailed discussion of each output can be found in the other
chapters.</caption>
<colgroup>
<col width="52%">
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th>File path</th>
<th>Resolution</th>
<th>GGIR part</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>40_100_400/</td>
<td>one file with time series per recording</td>
<td></td>
</tr>
<tr class="even">
<td>behavioralcodes2023-11-06.csv</td>
<td>dictionary for behavioural codes as used in the time series
file</td>
<td></td>
</tr>
</tbody>
</table>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vincent T van Hees, Jairo H Migueles, Medical Research Council UK, Accelting, French National Research Agency.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
