<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>10. Sleep Analysis • GGIR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="10. Sleep Analysis">
<script defer data-domain="pkgdown.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">GGIR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1-7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-the-book" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">The book</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-the-book">
<li><a class="dropdown-item" href="../articles/chapter1_WhatIsGGIR.html">1. What is GGIR</a></li>
    <li><a class="dropdown-item" href="../articles/chapter2_Pipeline.html">2. The GGIR Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/chapter3_QualityAssessment.html">3. Data Quality Assurance</a></li>
    <li><a class="dropdown-item" href="../articles/chapter4_AccMetrics.html">4. From Raw Data to Acceleration Metrics</a></li>
    <li><a class="dropdown-item" href="../articles/chapter5_StudyProtocol.html">5. Accounting for Study Protocol</a></li>
    <li><a class="dropdown-item" href="../articles/chapter6_DataImputation.html">6. How GGIR Deals with Invalid Data</a></li>
    <li><a class="dropdown-item" href="../articles/chapter7_DescribingDataWithoutKnowingSleep.html">7. Describing the Data Without Knowing Sleep</a></li>
    <li><a class="dropdown-item" href="../articles/chapter8_SleepFundamentalsSibs.html">8. Sleep Fundamentals - Sustained Inactivity Bout Detection (SIB)</a></li>
    <li><a class="dropdown-item" href="../articles/chapter9_SleepFundamentalsGuiders.html">9. Sleep Fundamentals - Guiding Sleep Detection</a></li>
    <li><a class="dropdown-item" href="../articles/chapter10_SleepAnalysis.html">10. Sleep Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/chapter11_DescribingDataCutPoints.html">11. Physical Activity Fundamentals - Describing the data with cut-points</a></li>
    <li><a class="dropdown-item" href="../articles/chapter12_TimeUseAnalysis.html">12. Time-Use Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/chapter13_CircadianRhythm.html">13. Circadian Rhythm Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/chapter14_BehaviouralFragmentation.html">14. Behavioural Fragmentation</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-annexes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Annexes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-annexes">
<li><a class="dropdown-item" href="../articles/GGIRParameters.html">GGIR Parameters</a></li>
    <li><a class="dropdown-item" href="../articles/GGIRoutput.html">GGIR Output</a></li>
    <li><a class="dropdown-item" href="../articles/readmyacccsv.html">Reading csv files with raw data</a></li>
    <li><a class="dropdown-item" href="../articles/ExternalFunction.html">Embedding external functions in GGIR</a></li>
    <li><a class="dropdown-item" href="../articles/CutPoints.html">Published cut-points and how to use them</a></li>
    <li><a class="dropdown-item" href="../articles/TutorialDaySegmentAnalyses.html">Day-segment analyses</a></li>
    <li><a class="dropdown-item" href="../articles/HouseHoldCoanalysis.html">Household co-analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Cookbook.html">Cookbook</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/chapter0_Installation.html">Installation</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/chapter0_GetStarted.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-3-1-5/">Version 3.1-5</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-3-1-0/">Version 3.1-0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-3-0-0/">Version 3.0-0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-2-9-0/">Version 2.9-0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-2-8-0/">Version 2.8-0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-2-7-1/">Version 2.7-1</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-2-6-0/">Version 2.6-0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.accelting.com/updates/ggir-release-2-5-0/">Version 2.5-0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/chapter0_Contributing.html">Contributing</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/chapter0_Support.html">Need help?</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/wadpac/GGIR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>10. Sleep Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/wadpac/GGIR/blob/HEAD/vignettes/chapter10_SleepAnalysis.Rmd" class="external-link"><code>vignettes/chapter10_SleepAnalysis.Rmd</code></a></small>
      <div class="d-none name"><code>chapter10_SleepAnalysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="sleep-analysis">Sleep analysis<a class="anchor" aria-label="anchor" href="#sleep-analysis"></a>
</h2>
<p>Sleep analysis in GGIR comes at three stages:</p>
<ol style="list-style-type: decimal">
<li><p>The discrimination of sustained inactivity and wakefulness
periods, discussed in chapter 8.</p></li>
<li><p>Identification of time windows that guide the eventual sleep
detection, as discussed chapter 9.</p></li>
<li><p>Assess overlap between the windows identified in step 1 and 2,
which we use to define the Sleep Period Time window (SPT) or the time in
bed window (TimeInBed) as discussed in this chapter.</p></li>
</ol>
<p>In the previous two chapters you learnt about the first two steps in
this chapter we will discuss the last step.</p>
<div class="section level3">
<h3 id="sleep-period-time-spt-window-or-time-in-bed">Sleep Period Time (SPT) window or Time in Bed<a class="anchor" aria-label="anchor" href="#sleep-period-time-spt-window-or-time-in-bed"></a>
</h3>
<p>Here we have two scenarios:</p>
<ol style="list-style-type: decimal">
<li><p>If the guider reflects an approximation of the Sleep Period Time
window, which is the window between sleep onset and waking up at the end
of the night, then any SIB that fully or partially overlaps with the
guider is considered sleep.</p></li>
<li><p>If a guider reflects the Time in Bed then any SIB that fully
overlaps with the guider is considered sleep. In this scenario sleep
latency and sleep efficiency can be estimated and are included in the
GGIR part 4 report.</p></li>
</ol>
<p>In both cases the start of the first SIB is then considered sleep
onset and the end of the last SIB is considered waking up.</p>
<p>For all guiders, other than “HorAngle”, parameter
<code>sleepwindowType</code> is automatically set to “SPT” corresponding
to scenario 1, such that no attempt is made to estimate sleep latency or
sleep efficiency.</p>
<p>If you use as guider a sleeplog that reflects the Time in Bed you
will need to set parameter <code>sleepwindowType = "TimeInBed"</code> to
tell GGIR to follow scenario 2.</p>
</div>
<div class="section level3">
<h3 id="quality-assurance">Quality assurance<a class="anchor" aria-label="anchor" href="#quality-assurance"></a>
</h3>
<div class="section level4">
<h4 id="cleaningcode">Cleaningcode<a class="anchor" aria-label="anchor" href="#cleaningcode"></a>
</h4>
<p>To monitor possible problems with the sleep detection, the output
variable <strong>cleaningcode</strong> is stored per night. Cleaningcode
per night (noon-noon or 6pm-6pm as described above) can have one of the
following values:</p>
<ul>
<li><p>0: sleep log available and SPT is identified.</p></li>
<li><p>1: sleep log not available, and alternative guider used (HDCZA by
default) and SPT is identified with that.</p></li>
<li><p>2: not enough valid accelerometer data in the present night,
where parameter <code>includenightcrit</code> is used to define how many
valid hours are need.</p></li>
<li><p>3: no accelerometer data available.</p></li>
<li><p>4: there are no nights to be analysed for this person.</p></li>
<li><p>5: SPT estimated based on guider only, because either no SIB was
found during the entire guider window which complicates defining the
start and end of the SPT, or the user specified the ID number of the
recording and the night number in the data_cleaning_file, more about
this further down, to tell GGIR to rely on the guider and not rely on
the accelerometer data for this particular night.</p></li>
<li><p>6: no sleep log available and also alternative guider
(HDCZA/HorAngle) failed for this specific night then use average guider
estimates from other nights in the recording as guider for this night.
If HDCZA/HorAngle estimates are also not available during the entire
recording then use L5+/-12 estimate for this night.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="visual-inspection-of-classifications">Visual inspection of classifications<a class="anchor" aria-label="anchor" href="#visual-inspection-of-classifications"></a>
</h4>
<p>As overlap between sib and guiders is difficult to review in a
quantitative way, GGIR offers the option to export a visualisation, with
parameter <code>do.visual = TRUE</code>. To manage the number of
visualisations generated it is possible to tell GGIR to only show
outliers. Here, outliers are defined as a difference between guider edge
and the final classification of sleep onset and wakeup time larger than
parameter <code>criterror</code>. When you set parameter
<code>outliers.only = TRUE</code> only nights considered to be an
outlier will be displayed.</p>
<p>This functionality is useful when reviewing classifications in large
data sets that use sleep logs. Visual inspection of outliers in this way
can for example help to identify data entry errors for sleep logs.</p>
</div>
<div class="section level4">
<h4 id="data-cleaning-file">Data cleaning file<a class="anchor" aria-label="anchor" href="#data-cleaning-file"></a>
</h4>
<p>After data quality check you may observe that some adjustments are
needed. Parameter <code>data_cleaning_file</code> (path to a csv file
you create) allows you to specify individuals and nights for whom part4
should entirely rely on the guider. The first column of this csv file
should have column name <code>ID</code> and there should be a column
<code>relyonguider_part4</code> to specify the night. The
<code>night_part4</code> allows you to tell GGIR which night(s) should
be omitted in part 4.</p>
</div>
</div>
<div class="section level3">
<h3 id="sleep-metrics-available-in-ggir">Sleep metrics available in GGIR<a class="anchor" aria-label="anchor" href="#sleep-metrics-available-in-ggir"></a>
</h3>
<p>For a full overview of all sleep variables in part 4 see: <a href="https://cran.r-project.org/web/packages/GGIR/vignettes/GGIR.html#42_Output_part_4" class="external-link uri">https://cran.r-project.org/web/packages/GGIR/vignettes/GGIR.html#42_Output_part_4</a></p>
<p>Among these we assume that most are intuitive:</p>
<ul>
<li><p>sleep onset and wakeup</p></li>
<li><p>Sleep duration during SPT, which is the accumulate sleep time
(sustained inactivity bouts classified as sleep)</p></li>
<li><p>WASO, the time spent in wakefulness after sleep onset. However,
there are possible a few concepts that need clarifications:</p></li>
</ul>
<div class="section level4">
<h4 id="sleep-regularity-index-sri">Sleep Regularity Index (SRI)<a class="anchor" aria-label="anchor" href="#sleep-regularity-index-sri"></a>
</h4>
<p>This is a measure of sleep regularity between successive days, as
first described by Phillips and colleagues. The SRI can have a value
between -100 and 100, where 100 reflects perfect regularity (identical
days), 0 reflects random pattern, and -100 reflects perfect reversed
regularity. The SRI is proposed to only be calculated based on seven, or
a multitude of seven, consecutive days of data without missing values.
This to avoid a possible role of imbalanced data to the final estimate.
However, this renders many datasets unsuitable for analysis and leads to
a painful loss in sample size and statistical power.</p>
<div class="section level5">
<h5 id="sleep-regularity-index-dealing-with-unbalanced-data">Sleep Regularity Index – Dealing with unbalanced data<a class="anchor" aria-label="anchor" href="#sleep-regularity-index-dealing-with-unbalanced-data"></a>
</h5>
<p>To address this, I implemented the SRI in GGIR per day-pair. Per
day-pair GGIR now stores the SRI value and the fraction of the 30 second
epoch-pairs between both days that are valid. This fraction can be found
in the output under the variable name SriFractionValid. By default,
day-pairs are excluded if this fraction is below 0.66. For those
familiar with GGIR this threshold is coupled with the 16-hour default
value for parameter “includenightcrit”. For example, if you set
parameter “includenightcrit = 12”, the fraction threshold will be: 12 /
24 = 0.5. Note that I have implemented the SRI calculation such that it
accounts for the missing values in the denominator. As a result, the SRI
value interpretation remains unchanged.</p>
<p>The 30 second epoch setting is automatically applied, even if the
rest of the GGIR process works with a different epoch duration.</p>
<p>The day-pair level estimates are stored as variable
<code>SleepRegularityIndex</code> in the GGIR part 4 .csv-report on
sleep. Further, GGIR also stores the person-level aggregates such as:
the plain average over all valid days, the average of all valid weekend
days, and the average of all valid week days. No GGIR input arguments
are needed to invoke the SRI calculation. The calculation is
automatically performed after updating GGIR and processing your
data.</p>
</div>
<div class="section level5">
<h5 id="sleep-regularity-index-benefits-of-the-revised-approach">Sleep Regularity Index – Benefits of the revised approach<a class="anchor" aria-label="anchor" href="#sleep-regularity-index-benefits-of-the-revised-approach"></a>
</h5>
<p>It enables the user to study the day-pair to day-pair variation in
SRI, and the role of day-pair inclusion criteria.</p>
<p>The access to SRI at day-pair level makes it possible to account for
an imbalanced datasets via multilevel regression analysis applied to the
output of GGIR, with day-pair as one of the model levels.</p>
</div>
<div class="section level5">
<h5 id="nap-detection">Nap detection<a class="anchor" aria-label="anchor" href="#nap-detection"></a>
</h5>
<p>Any references to daytime nap detection in GGIR is based on
experimental functionality that requires ongoing investigation. Once
this functionality has matured we will expand the documentation
accordingly.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="key-parameters">Key parameters<a class="anchor" aria-label="anchor" href="#key-parameters"></a>
</h3>
<p>All parameters that are part of the params_sleep category as
discussed in section “Sleep parameters” in <a href="https://cran.r-project.org/web/packages/GGIR/vignettes/GGIRParameters.html" class="external-link uri">https://cran.r-project.org/web/packages/GGIR/vignettes/GGIRParameters.html</a></p>
<p>and</p>
<ul>
<li>
<code>do.visual</code>, <code>outliers.only</code>, and
<code>criterror</code>.</li>
<li>
<code>excludefirstlast</code>.</li>
<li><code>def.noc.sleep</code></li>
<li><code>includenightcrit</code></li>
<li><code>data_cleaning_file</code></li>
</ul>
</div>
<div class="section level3">
<h3 id="related-output">Related output<a class="anchor" aria-label="anchor" href="#related-output"></a>
</h3>
<p>GGIR stores two type of output: The cleaned and the full output. In
the cleaned output invalid nights have been removed, while in the full
output these nights are included.</p>
<p>More specifically, a night is excluded from the ‘cleaned’ results
based on the following criteria:</p>
<ul>
<li><p>If the study proposed a sleep log to the individuals, then nights
are excluded for which the sleep log was not used as a guider. In other
words: nights with cleaningcode not equal to 0 or variable sleep log
used equals FALSE).</p></li>
<li><p>If the study did not propose a sleep log to the individuals, then
all nights are removed with cleaningcode higher than 1.</p></li>
</ul>
<table class="table">
<colgroup>
<col width="45%">
<col width="12%">
<col width="42%">
</colgroup>
<thead><tr class="header">
<th>Filename</th>
<th>Folder</th>
<th>Content</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>part4_nightsummary_cleaned.csv</td>
<td>results</td>
<td>cleaned night level results</td>
</tr>
<tr class="even">
<td>part4_summary_cleaned.csv</td>
<td>results</td>
<td>cleaned person level results</td>
</tr>
<tr class="odd">
<td>part4_nigthsummary_full.csv</td>
<td>results</td>
<td>full night level results</td>
</tr>
</tbody>
</table>
<p>Be aware that if using the full output and working with wrist
accelerometer data, missing entries in a sleep log that asks for Time in
Bed will be replaced by HDCZA estimates of SPT. Therefore, extra caution
should be taken when working with the full output.</p>
<p>Notice that part 4 is focused on sleep research. In the chapters we
will discuss the analysis done by part 5. There, the choice of guider
may be considered less important, by which any estimate of the time in
bed is considered useful. So, you may see that a night that is excluded
from the cleaned results in part 4 still appears in the cleaned results
for part 5.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vincent T van Hees, Jairo H Migueles, Medical Research Council UK, Accelting, French National Research Agency.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
